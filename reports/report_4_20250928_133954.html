<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Trade Report - Professional Market Analysis</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        html, body {
            font-family: 'Times New Roman', serif;
            font-size: 12pt;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            width: 100%;
            min-width: 100%;
            box-sizing: border-box;
        }
        .container {
            width: 100vw;
            min-width: 100%;
            margin: 0;
            background: white;
            padding: 40px;
            border-radius: 0;
            box-shadow: none;
            box-sizing: border-box;
        }
        h1 {
            color: #2c3e50;
            font-weight: bold;
            font-size: 18pt;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            font-weight: bold;
            font-size: 16pt;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        h3 {
            color: #2c3e50;
            font-weight: bold;
            font-size: 14pt;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        h4 {
            color: #7f8c8d;
            font-weight: bold;
            font-size: 12pt;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        ul, ol {
            margin-bottom: 15px;
            padding-left: 30px;
            line-height: 1.5;
        }
        li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        /* Professional bullet points */
        ul li {
            list-style-type: disc;
            margin-left: 20px;
        }
        ul ul li {
            list-style-type: circle;
        }
        ul ul ul li {
            list-style-type: square;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e8f4f8;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .summary-box {
            background-color: #d4edda;
            padding: 20px;
            border-left: 4px solid #28a745;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 20px 0;
            border-radius: 4px;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        /* Professional Report Header */
        .report-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.25rem;
            color: #1f2937;
        }
        .header-brand .brand-icon {
            font-size: 1.5rem;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header-actions {
            display: flex;
            gap: 0.75rem;
        }
        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .action-btn:active {
            transform: translateY(0);
        }
        .action-btn.print {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .action-btn.pdf {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        /* Hide download button on mobile devices */
        @media (max-width: 768px) {
            .action-btn.pdf {
                display: none !important;
            }
        }
        .action-btn.save {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        .action-btn.home {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .btn-icon {
            font-size: 1rem;
        }
        .btn-text {
            font-size: 0.875rem;
        }
        
        /* Report Title Section */
        .report-title-section {
            text-align: center;
            margin-bottom: 2rem;
            padding-top: 6rem;
        }
        .title-underline {
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #2563eb, #7c3aed);
            margin: 1rem auto 0;
            border-radius: 2px;
        }
        
        /* Enhanced Summary Box */
        .summary-box {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #bae6fd;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .summary-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #0369a1;
            font-size: 1.125rem;
        }
        .summary-icon {
            font-size: 1.25rem;
        }
        .summary-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .summary-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .item-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .item-value {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }
                 @media print {
             body { 
                 background-color: white !important; 
                 color: black !important;
                 font-size: 12pt;
                 line-height: 1.4;
                 margin: 0 !important;
                 padding: 0 !important;
                 width: 100% !important;
             }
             .container { 
                 box-shadow: none !important; 
                 background: white !important;
                 padding: 20px !important;
                 margin: 0 !important;
                 width: 100% !important;
                 min-width: 100% !important;
                 max-width: none !important;
                 box-sizing: border-box !important;
                 height: auto !important;
                 min-height: 100vh !important;
             }
             .report-header { display: none !important; }
             .action-buttons { display: none !important; }
             h1, h2, h3, h4 { 
                 color: black !important; 
                 page-break-after: avoid;
                 page-break-inside: avoid;
             }
             table { 
                 page-break-inside: avoid; 
                 border-collapse: collapse !important;
             }
             .summary-box, .highlight, .warning-box {
                 background: #f8f9fa !important;
                 border: 1px solid #ddd !important;
                 color: black !important;
                 page-break-inside: avoid;
             }
             p, li {
                 page-break-inside: avoid;
                 orphans: 3;
                 widows: 3;
             }
             .footer {
                 page-break-inside: avoid;
             }
         }
        /* ===== MOBILE RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .header-content {
                padding: 0 1.5rem;
            }
            .container {
                padding: 30px;
            }
        }
        
        @media (max-width: 768px) {
            /* Mobile Header */
            .report-header {
                padding: 0.75rem 0;
            }
            .header-content {
                padding: 0 1rem;
                flex-direction: column;
                gap: 0.75rem;
                align-items: center;
            }
            .header-brand {
                font-size: 1.125rem;
            }
            .header-actions {
                width: 100%;
                justify-content: center;
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            .action-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
                flex: 1;
                max-width: 120px;
                display: flex;
                align-items: center;
                gap: 0.375rem;
            }
            .btn-text {
                font-size: 0.8125rem;
                display: inline !important;
            }
            
            /* Mobile Container */
            .container {
                padding: 20px 15px;
                margin-top: 120px; /* Account for taller mobile header */
            }
            
            /* Mobile Typography */
            h1 {
                font-size: 1.75rem;
                margin-bottom: 20px;
            }
            h2 {
                font-size: 1.375rem;
                margin-top: 25px;
                margin-bottom: 15px;
            }
            h3 {
                font-size: 1.125rem;
                margin-top: 20px;
                margin-bottom: 12px;
            }
            h4 {
                font-size: 1rem;
                margin-top: 15px;
                margin-bottom: 8px;
            }
            p {
                font-size: 0.9375rem;
                line-height: 1.6;
                margin-bottom: 12px;
            }
            
            /* Mobile Tables */
            table {
                font-size: 0.875rem;
                margin: 15px 0;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            th, td {
                padding: 8px 6px;
                min-width: 80px;
            }
            th {
                font-size: 0.8125rem;
            }
            
            /* Mobile Lists */
            ul, ol {
                padding-left: 20px;
                margin-bottom: 12px;
            }
            li {
                font-size: 0.9375rem;
                margin-bottom: 6px;
                line-height: 1.5;
            }
            
            /* Mobile Boxes */
            .summary-box, .highlight, .warning-box {
                padding: 15px;
                margin: 15px 0;
                border-radius: 8px;
            }
            .summary-content {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            .summary-item {
                padding: 8px 0;
            }
            .item-label {
                font-size: 0.8125rem;
            }
            .item-value {
                font-size: 0.9375rem;
            }
            
            /* Mobile Code Blocks */
            .code-block {
                padding: 12px;
                font-size: 0.8125rem;
                margin: 12px 0;
                border-radius: 6px;
            }
            
            /* Mobile Footer */
            .footer {
                margin-top: 30px;
                padding-top: 15px;
                font-size: 0.8125rem;
            }
        }
        
        @media (max-width: 480px) {
            /* Extra Small Mobile */
            .container {
                padding: 15px 10px;
                margin-top: 140px;
            }
            
            .header-content {
                padding: 0 0.75rem;
            }
            .header-brand {
                font-size: 1rem;
            }
            .action-btn {
                padding: 0.375rem 0.5rem;
                font-size: 0.6875rem;
                max-width: 100px;
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }
            .btn-text {
                font-size: 0.75rem;
                display: inline !important;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            h2 {
                font-size: 1.25rem;
            }
            h3 {
                font-size: 1.0625rem;
            }
            
            table {
                font-size: 0.8125rem;
            }
            th, td {
                padding: 6px 4px;
                min-width: 70px;
            }
            
            .summary-box, .highlight, .warning-box {
                padding: 12px;
                margin: 12px 0;
            }
            
            .code-block {
                padding: 10px;
                font-size: 0.75rem;
            }
        }
        
        /* Mobile Print Optimizations */
        @media print and (max-width: 768px) {
            .container {
                padding: 15px !important;
                margin: 0 !important;
                width: 100% !important;
            }
            h1, h2, h3, h4 {
                page-break-after: avoid;
                font-size: 1.2em;
            }
            table {
                font-size: 0.8em;
                page-break-inside: avoid;
            }
            .summary-box, .highlight, .warning-box {
                page-break-inside: avoid;
                margin: 10px 0;
            }
        }
        @media screen {
            body {
                margin: 0;
                padding: 0;
            }
        }
        
        /* Saved Reports Section Styles */
        .saved-reports-section {
            padding: 2rem 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 400px;
        }
        
        .saved-reports-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 0 auto;
            max-width: 1200px;
        }
        
        .saved-reports-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .saved-reports-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .title-icon {
            font-size: 1.5rem;
        }
        
        .saved-reports-subtitle {
            color: #64748b;
            font-size: 1rem;
            margin: 0;
        }
        
        .saved-reports-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .saved-report-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .saved-report-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }
        
        .saved-report-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        }
        
        .report-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .report-item-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
            line-height: 1.4;
        }
        
        .report-item-date {
            font-size: 0.875rem;
            color: #64748b;
            white-space: nowrap;
        }
        
        .report-item-details {
            margin-bottom: 1rem;
        }
        
        .report-detail-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .report-detail-label {
            font-weight: 500;
            color: #475569;
            min-width: 80px;
            margin-right: 0.5rem;
        }
        
        .report-detail-value {
            color: #1e293b;
            flex: 1;
        }
        
        .report-item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .report-action-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
        }
        
        .report-action-btn.primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .report-action-btn.primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
        }
        
        .report-action-btn.secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }
        
        .report-action-btn.secondary:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
        }
        
        .no-reports-message {
            text-align: center;
            padding: 3rem 2rem;
            color: #64748b;
        }
        
        .no-reports-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .no-reports-message h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #475569;
            margin-bottom: 0.5rem;
        }
        
        .no-reports-message p {
            font-size: 1rem;
            margin: 0;
        }
        
        .saved-reports-toggle {
            background: none;
            border: none;
            color: inherit;
            font-size: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .saved-reports-toggle:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .saved-reports-toggle.active {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }
        
        .nav-icon {
            font-size: 1rem;
        }
        
        /* Mobile Responsive for Saved Reports */
        @media (max-width: 768px) {
            .saved-reports-list {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .saved-report-item {
                padding: 1rem;
            }
            
            .report-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .report-item-actions {
                flex-direction: column;
            }
            
            .saved-reports-card {
                padding: 1.5rem;
                margin: 0 1rem;
            }
            
        .saved-reports-title {
            font-size: 1.5rem;
        }
    }
    
    /* Loading and Error States */
    .loading-reports {
        text-align: center;
        padding: 2rem;
        color: #64748b;
        font-size: 1rem;
    }
    
        .error-message {
        text-align: center;
        padding: 2rem;
        color: #dc2626;
        font-size: 1rem;
        }

        /* Custom styles for Bootstrap modal enhancements */
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-header .btn-close {
            filter: invert(1);
        }

        .sortable {
            cursor: pointer;
            user-select: none;
        }

        .sortable:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sort-indicator {
            margin-left: 8px;
            opacity: 0.5;
            transition: all 0.2s ease;
        }

        .sortable.asc .sort-indicator {
            opacity: 1;
            transform: rotate(180deg);
        }

        .sortable.desc .sort-indicator {
            opacity: 1;
        }

        /* Custom Navbar Styles */
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 0.75rem 0;
        }

        .navbar-brand {
            font-size: 1.5rem;
            color: #333 !important;
        }

        .navbar-brand .brand-logo-img {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .navbar-nav .btn {
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            padding: 0.5rem 1rem;
        }

        .navbar-nav .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .navbar-nav .btn-outline-primary:hover {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        .navbar-nav .btn-outline-secondary:hover {
            background-color: #6c757d;
            border-color: #6c757d;
        }

        .navbar-nav .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        /* Responsive navbar */
        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1.25rem;
            }
            
            .navbar-nav .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }
            
            .navbar-nav {
                margin-top: 1rem;
            }
        }

        /* Scrollable Table Styles */
        .table-responsive {
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .table-responsive::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .table-responsive::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .sticky-top {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table th {
            white-space: nowrap;
            font-weight: 600;
        }

        .table td {
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <!-- Professional Report Header -->
    <header class="report-header">
        <div class="header-content">
            <div class="header-brand">
                <img src="/static/logo_trade_on_chain.png" alt="AI Trade Report" class="brand-logo" style="height: 32px; width: auto; margin-right: 12px;">
                <img src="/static/logo2.png" alt="AI Trade Report" class="brand-logo" style="height: 32px; width: auto; margin-right: 12px;">
                <span class="brand-text">AI Trade Report</span>
            </div>
            <div class="header-actions">
                <button class="action-btn save" onclick="saveReport()">
                    <span class="btn-icon">💾</span>
                    <span class="btn-text">Save</span>
                </button>
                <button class="action-btn home" onclick="returnToMain()">
                    <span class="btn-icon">🏠</span>
                    <span class="btn-text">Home</span>
                </button>
                <button class="action-btn print" onclick="window.print()">
                    <span class="btn-icon">🖨️</span>
                    <span class="btn-text">Print</span>
                </button>
                <button class="action-btn pdf" onclick="downloadPDF()">
                    <span class="btn-icon">📄</span>
                    <span class="btn-text">Download PDF</span>
                </button>
            </div>
        </div>
    </header>
    
    <div class="container" id="report-content">
        <div class="report-title-section">
            <h1>AI Trade Report</h1>
            <div class="title-underline"></div>
        </div>
        <div class="summary-box">
            <div class="summary-header">
                <span class="summary-icon">📋</span>
                <span class="summary-title">Report Overview</span>
            </div>
            <div class="summary-content">
                <div class="summary-item">
                    <span class="item-label">Generated by:</span>
                    <span class="item-value">AI-Powered Market Research</span>
                </div>
                <div class="summary-item">
                    <span class="item-label">Date:</span>
                    <span class="item-value">28 September 2025</span>
                </div>
                <div class="summary-item">
                    <span class="item-label">Report Type:</span>
                    <span class="item-value">Comprehensive Market Analysis</span>
                </div>
            </div>
        </div>
        <p>Title: Strategic Market Analysis Report for Cherry Tomatoes under the brand tomato</p>
        <p>Analysis Date: 28 September 2025</p>
        <p>Enterprise Size: Small Enterprise</p>
        <p>Total Available Budget: 10,000</p>
        <br>
        <p>Executive Summary</p>
        <p>This report assesses near-term, low-budget market expansion options for cherry tomatoes under the brand tomato across select European and non-European markets. Given a constrained budget of 10,000, the recommended approach is to prioritize EU markets where regulatory alignment, logistics simplicity, and buyer familiarity enable quick testing and conversion, then selectively pilot export-ready channels in non-EU markets via marketplaces and import aggregators. Action emphasizes digital demand generation, buyer sampling, and partnerships with importers and wholesale platforms rather than capital-intensive retail listings.</p>
        <br>
        <p>Based on verified trade and retail context from official sources, the EU offers lower regulatory friction and unified food law frameworks for fresh produce, with Germany, France, Netherlands, Italy, Spain, and Poland representing high-volume fresh tomato demand and strong distribution infrastructure. Outside Europe, near-term opportunities exist in the United Kingdom, Gulf Cooperation Council markets, and Singapore, using importer-led distribution. All market size figures below are presented as directional estimates with transparent assumptions due to limited public, product-level retail revenue data. The proposed 90-day plan focuses on B2B buyer acquisition, compliance readiness, and small-batch trials, allocating budget primarily to samples, cold-chain logistics tests, certifications, and marketplace onboarding.</p>
        <br>
        <p>Market Overview</p>
        <ul>
            <li>EU fresh tomatoes represent a high-volume category with strong intra-EU trade flows and established standards for quality grades, residues, and labeling. Retail pricing and consumer preference vary by region, with higher willingness to pay for premium on-the-vine or specialty cherry tomatoes in Northern and Western Europe.</li>
            <li>Non-EU markets present opportunity but require careful management of phytosanitary requirements, tariff exposure, and cold-chain integrity to protect shelf life and quality.</li>
        </ul>
        <p>Target Market Analysis</p>
        <p>TAM, SAM, SOM by priority markets (Estimates)</p>
        <p>Methodology and assumptions</p>
        <ul>
            <li>TAM: Retail value of cherry tomatoes inferred from national fresh tomato retail market size proportionality. Due to lack of official cherry-only value series, we apply a conservative cherry share band of 10 percent to 20 percent of total fresh tomato retail value in mature markets, 5 percent to 10 percent in price-sensitive markets. Clearly labeled as Estimate.</li>
            <li>SAM: Addressable share within higher-income urban channels and retailers that list cherry or snacking tomatoes, generally 40 percent to 60 percent of TAM in Western Europe, 25 percent to 40 percent in Eastern Europe and selected non-EU markets. Estimate.</li>
            <li>SOM Year 1: Realistic first-year capture via trial listings or importer programs assuming micro-batch volumes, limited marketing, and small enterprise scale, generally 0.01 percent to 0.1 percent of SAM. Estimate.</li>
        </ul>
        <p>Important data transparency note</p>
        <ul>
            <li>Official, disaggregated retail value data specifically for cherry tomatoes is not available from Eurostat, FAO, or OECD at the product variant level. The following ranges are directional estimates intended for planning, not for financial reporting.</li>
        </ul>
        <p>Comparative TAM/SAM/SOM Table (Estimates)</p>
        <table>
            <tr>
                <td>Country or Market</td>
                <td>TAM Cherry Tomatoes Retail Value (Estimate)</td>
                <td>SAM Addressable Channels (Estimate)</td>
                <td>SOM Year 1 Value Capture (Estimate)</td>
            </tr>
            <tr>
                <th>-------------------</th>
                <th>---------------------------------------------</th>
                <th>-------------------------------------</th>
                <th>-------------------------------------</th>
            </tr>
            <tr>
                <td>Germany</td>
                <td>700-1,100 EUR M</td>
                <td>300-600 EUR M</td>
                <td>0.15-0.60 EUR M</td>
            </tr>
            <tr>
                <td>France</td>
                <td>600-1,000 EUR M</td>
                <td>250-500 EUR M</td>
                <td>0.12-0.50 EUR M</td>
            </tr>
            <tr>
                <td>Netherlands</td>
                <td>250-450 EUR M</td>
                <td>120-250 EUR M</td>
                <td>0.06-0.25 EUR M</td>
            </tr>
            <tr>
                <td>Italy</td>
                <td>500-900 EUR M</td>
                <td>200-450 EUR M</td>
                <td>0.10-0.45 EUR M</td>
            </tr>
            <tr>
                <td>Spain</td>
                <td>400-700 EUR M</td>
                <td>160-350 EUR M</td>
                <td>0.08-0.35 EUR M</td>
            </tr>
            <tr>
                <td>Poland</td>
                <td>150-300 EUR M</td>
                <td>50-120 EUR M</td>
                <td>0.03-0.12 EUR M</td>
            </tr>
            <tr>
                <td>United Kingdom</td>
                <td>500-850 GBP M</td>
                <td>220-450 GBP M</td>
                <td>0.10-0.45 GBP M</td>
            </tr>
            <tr>
                <td>GCC hubs (UAE, Saudi Arabia)</td>
                <td>180-320 USD M</td>
                <td>70-160 USD M</td>
                <td>0.03-0.16 USD M</td>
            </tr>
            <tr>
                <td>Singapore</td>
                <td>35-70 USD M</td>
                <td>15-35 USD M</td>
                <td>0.01-0.03 USD M</td>
            </tr>
            <tr>
                <td>United States coastal premium retail</td>
                <td>900-1,600 USD M</td>
                <td>350-750 USD M</td>
                <td>0.18-0.75 USD M</td>
            </tr>
        </table>
        <p>Reasoning summary for estimates</p>
        <ul>
            <li>EU fresh tomato market volumes and values are large with sustained imports within the single market and from Morocco and Turkey. Cherry share has expanded in premium retail due to snacking trends; Northern Europe shows higher per-capita spend on small tomatoes.</li>
            <li>UK remains a strong premium tomato market post-Brexit with heavy imports and private label penetration.</li>
            <li>GCC and Singapore rely on imports for year-round supply, featuring high-price premium categories in modern retail.</li>
            <li>United States shows significant demand for snacking tomatoes in premium chains, but first-year entry for a small enterprise is limited by high logistics and compliance costs.</li>
        </ul>
        <p>Competitive Landscape</p>
        <p>Note on data availability</p>
        <ul>
            <li>Publicly available sources identify major greenhouse producers and import flows, but market shares at cherry segment level by country are not publicly disclosed. We therefore provide a qualitative matrix of known competitive strengths by region. We avoid naming specific companies without official market share citations.</li>
        </ul>
        <p>Competitive Landscape Matrix</p>
        <table>
            <tr>
                <td>Region</td>
                <td>Market Structure</td>
                <td>Strengths of Incumbents</td>
                <td>Weaknesses or Gaps</td>
            </tr>
            <tr>
                <th>--------</th>
                <th>------------------</th>
                <th>-------------------------</th>
                <th>--------------------</th>
            </tr>
            <tr>
                <td>Western EU core (DE, FR, NL)</td>
                <td>Consolidated supermarket buying, strong greenhouse supply in NL, ES, MA imports</td>
                <td>Scale, year-round consistency, established QA schemes like GlobalG.A.P.</td>
                <td>Retailers still test niche varieties and premium snacking packs; room for branded storytelling and sustainable packaging</td>
            </tr>
            <tr>
                <td>Southern EU (IT, ES)</td>
                <td>Strong domestic production, cooperative networks</td>
                <td>Local freshness, varietal breadth, price competitiveness</td>
                <td>Fragmentation outside top cooperatives allows niche entry via specialty retail and e-commerce</td>
            </tr>
            <tr>
                <td>Eastern EU (PL)</td>
                <td>Price-sensitive, growing modern trade</td>
                <td>Rapid modern retail expansion</td>
                <td>Gaps in premium cherry assortment outside major cities</td>
            </tr>
            <tr>
                <td>UK</td>
                <td>High private label, import reliant</td>
                <td>Efficient category management, year-round supply</td>
                <td>Opportunities in specialty and online grocery for differentiated branding</td>
            </tr>
            <tr>
                <td>GCC and Singapore</td>
                <td>Import dependent, premium positioning</td>
                <td>Efficient cold-chain importers and re-export hubs</td>
                <td>Space for premium branding, air-freight freshness stories, and pesticide-residue guarantees</td>
            </tr>
            <tr>
                <td>United States coastal premium</td>
                <td>Large category, sophisticated buyers</td>
                <td>Stringent FSMA compliance, strong domestic greenhouse players</td>
                <td>Open to unique varieties and sustainability credentials in specialty retail</td>
            </tr>
        </table>
        <p>Regulatory Environment</p>
        <p>European Union</p>
        <ul>
            <li>Food safety and hygiene: Regulation (EC) No 178/2002 laying down general principles of food law and Regulation (EC) No 852/2004 on food hygiene set the baseline for all food placed on the EU market. Source: EUR-Lex, consolidated texts, most recently accessed 2024 to 2025.</li>
            <li>Maximum residue levels: Regulation (EC) No 396/2005 on pesticide residue limits, with product-specific MRLs for tomatoes in EU MRL database. Source: European Commission MRL database, updated periodically, accessed 2024 to 2025.</li>
            <li>Marketing standards for fruit and vegetables: Commission Implementing Regulation (EU) No 543/2011 sets quality classes and labeling for tomatoes including cherry types. Source: EUR-Lex, consolidated, latest amendments accessed 2024.</li>
            <li>Traceability: Article 18 of Regulation (EC) No 178/2002 requires one-step-forward, one-step-back traceability.</li>
            <li>Packaging and labeling: Regulation (EU) No 1169/2011 on food information to consumers applies to prepacked produce labeling. Non-prepacked fresh fruit and vegetables in retail require origin indication under EU marketing standards. Source: EUR-Lex.</li>
            <li>CE marking: Not applicable to fresh food products. GDPR applies to consumer data captured via digital channels. Source: Regulation (EU) 2016/679.</li>
        <p>United Kingdom</p>
            <li>UK retains equivalent food safety rules under retained EU law and the Food Safety Act 1990; pre-export notifications and IPAFFS import declarations apply. Source: UK Government guidance, 2023 to 2025.</li>
        <p>Non-EU Selected Markets</p>
            <li>GCC: Gulf Standardization Organization standards and national SFDA/SFDA-like controls, with phytosanitary certificates and import permits required. Source: National food authority portals, 2023 to 2025.</li>
            <li>Singapore: Singapore Food Agency requires importers to be licensed and meet SFA conditions for fresh produce, including phytosanitary certification. Source: SFA, 2023 to 2025.</li>
            <li>United States: FDA FSMA Produce Safety Rule for growers and FSVP for importers; USDA APHIS phytosanitary requirements. Source: FDA and USDA, 2023 to 2025.</li>
        </ul>
        <p>Consumer Analysis</p>
        <ul>
            <li>EU consumers show increasing preference for convenient snacking formats and smaller tomato varieties in Northern and Western Europe, with premium adoption in urban centers. Organic and residue-conscious buyers pay a premium when supported by credible certifications. Source: European Commission market observations and retailer category updates, 2023 to 2025.</li>
            <li>UK and Benelux consumers exhibit high online grocery uptake, supporting direct-to-consumer bundles and seasonal boxes.</li>
            <li>GCC and Singapore shoppers show willingness to pay for freshness, premium packaging, and imported quality claims; origin stories and air-freight freshness resonate.</li>
            <li>Price elasticity is higher in Southern and Eastern Europe; value packs with competitive per-kilo pricing are essential to drive trial.</li>
        </ul>
        <p>Distribution Channels</p>
        <ul>
            <li>EU: Centralized supermarket buying groups, fresh produce wholesalers at terminal markets, and B2B platforms such as Amsterdam’s Food Centre, Rungis in France, and national wholesale networks. Cross-border trade benefits from the EU single market with no internal tariffs and harmonized standards. Source: European Commission Single Market overview, accessed 2024 to 2025.</li>
            <li>UK: Importers and category managers serving major grocers; wholesale markets like New Spitalfields and Birmingham Wholesale Market continue to serve foodservice and independents.</li>
            <li>GCC and Singapore: Import-led through specialized produce importers and re-export hubs with established cold chain. Relationships with a handful of key importers can open multiple retail and HORECA doors.</li>
            <li>Digital B2B: EU and UK fresh-produce marketplaces and sourcing portals allow supplier onboarding, sample requests, and spot deals. Examples include national wholesale exchange platforms and buyer-supplier directories operated by trade promotion agencies. Data note: specific platform volumes are not publicly disclosed.</li>
        </ul>
        <p>Pricing Strategies and Cost Structure Considerations</p>
        <ul>
            <li>Premium pack formats: 250 g to 500 g clamshells or top-seal trays with branding support premium positioning in DE, NL, UK, and SG.</li>
            <li>Value formats: 500 g to 1 kg punnets or flow-pack for ES, IT, and PL mass retail.</li>
            <li>FOB and landed cost sensitivity: Air vs road freight materially impacts feasibility outside Europe. For a small enterprise, near-term focus should be on road-accessible EU markets and small-batch airfreight to GCC or Singapore for premium-priced pilots. Estimates should be validated by live quotes.</li>
        </ul>
        <p>Trade Agreements and Tariff Context</p>
        <ul>
            <li>Intra-EU: No tariffs and streamlined trade under the single market. Source: European Commission Single Market, accessed 2024 to 2025.</li>
            <li>EU to UK: Post-Brexit, sanitary and phytosanitary checks and import declarations are required; tariffs depend on origin and rules of origin. Source: UK Government guidance, 2024 to 2025.</li>
            <li>EU to GCC and Singapore: Typically MFN tariffs plus SPS rules; fresh produce often faces low ad valorem tariffs but strict phytosanitary controls. Verify per HS 0702 tomatoes prior to shipments. Sources: WTO Tariff Data, national customs portals, accessed 2024 to 2025.</li>
        </ul>
        <p>Risk Assessment</p>
        <p>Risk Assessment Matrix</p>
        <table>
            <tr>
                <td>Risk</td>
                <td>Likelihood</td>
                <td>Impact</td>
                <td>Mitigation</td>
            </tr>
            <tr>
                <th>------</th>
                <th>------------</th>
                <th>--------</th>
                <th>------------</th>
            </tr>
            <tr>
                <td>Cold-chain failure affecting shelf life</td>
                <td>Medium</td>
                <td>High</td>
                <td>Use temperature loggers, validated packaging, and select carriers with proven produce experience</td>
            </tr>
            <tr>
                <td>Residue non-compliance with EU MRLs</td>
                <td>Low to Medium</td>
                <td>High</td>
                <td>Pre-harvest interval controls, accredited lab testing against EC 396/2005 prior to shipment</td>
            </tr>
            <tr>
                <td>Retail buyer concentration and delisting</td>
                <td>Medium</td>
                <td>Medium</td>
                <td>Diversify channels via wholesalers and online B2B platforms; avoid single-buyer dependence</td>
            </tr>
            <tr>
                <td>Currency volatility for non-EU sales</td>
                <td>Medium</td>
                <td>Medium</td>
                <td>Invoice in EUR where acceptable, short payment terms, or forward cover for GBP and USD</td>
            </tr>
            <tr>
                <td>Regulatory documentation errors at border</td>
                <td>Medium</td>
                <td>High</td>
                <td>Standardized checklists, exporter training, and pre-clearance with import partners</td>
            </tr>
            <tr>
                <td>Insufficient working capital for scale</td>
                <td>High</td>
                <td>Medium</td>
                <td>Stage-gate pilots, negotiate prepayments or consignment terms with trusted buyers</td>
            </tr>
        </table>
        <p>Strategic Recommendations</p>
        <ul>
            <li>Prioritize EU core markets for first 90 days: Germany, Netherlands, and France for premium snacking formats, leveraging unified EU compliance and road logistics.</li>
            <li>Secondary EU focus: Italy, Spain, and Poland for value formats via wholesalers and regional chains to balance volume and margin.</li>
            <li>Non-EU pilots: UK and one premium import hub (UAE or Singapore) via importer partnerships and small-batch airfreight to test brand acceptance and validate landed cost and pricing.</li>
            <li>Certification and compliance: Implement GlobalG.A.P. and if applicable GRASP, and maintain residue testing certificates per EC 396/2005 to meet retailer prerequisites.</li>
            <li>Brand positioning: Emphasize freshness, sweetness, and traceability. Offer two SKU families: premium clamshell 250 g to 400 g and value 500 g to 1 kg. QR-coded lot-level traceability to support GDPR-compliant consumer engagement.</li>
            <li>Demand generation: Allocate budget to targeted B2B outreach, samples to 25 to 40 priority buyers, and category-specific sales materials with specification sheets and test reports.</li>
            <li>Route-to-market: Engage wholesale markets and 3 to 5 importer-distributors in each target region, use framework offers with weekly pricing tied to market benchmarks.</li>
            <li>Data discipline: Track per-shipment shrink, on-shelf days, and buyer feedback; use pilot results to refine pricing and packaging.</li>
        </ul>
        <p>Budget Allocation Recommendations</p>
        <p>Budget Allocation Table</p>
        <table>
            <tr>
                <td>Use of Funds</td>
                <td>Allocation EUR</td>
                <td>Rationale</td>
            </tr>
            <tr>
                <th>--------------</th>
                <th>----------------</th>
                <th>-----------</th>
            </tr>
            <tr>
                <td>Compliance and testing packets (residue, nitrate, micro)</td>
                <td>1,800</td>
                <td>Prerequisite for EU and importer acceptance</td>
            </tr>
            <tr>
                <td>Samples and pilot logistics EU (road)</td>
                <td>2,200</td>
                <td>12 to 18 buyer sample drops across DE, NL, FR</td>
            </tr>
            <tr>
                <td>Samples and pilot logistics non-EU (air, UK plus UAE or SG)</td>
                <td>2,200</td>
                <td>2 to 3 small consignments to test demand and landed cost</td>
            </tr>
            <tr>
                <td>Buyer development and travel-lite meetings</td>
                <td>1,200</td>
                <td>Trade days at wholesale markets and video calls</td>
            </tr>
            <tr>
                <td>Marketing collateral and packaging pilots</td>
                <td>1,400</td>
                <td>Branded labels, spec sheets, QR traceability</td>
            </tr>
            <tr>
                <td>Marketplace and importer onboarding fees</td>
                <td>700</td>
                <td>Registrations and documentation</td>
            </tr>
            <tr>
                <td>Contingency</td>
                <td>500</td>
                <td>Buffer for rate fluctuations</td>
            </tr>
        </table>
        <p>Implementation Plan</p>
        <p>90-Day Action Plan</p>
        <table>
            <tr>
                <td>Week</td>
                <td>Workstream</td>
                <td>Key Actions</td>
                <td>Owner</td>
                <td>Deliverables</td>
            </tr>
            <tr>
                <th>------</th>
                <th>------------</th>
                <th>-------------</th>
                <th>-------</th>
                <th>--------------</th>
            </tr>
            <tr>
                <td>1-2</td>
                <td>Compliance readiness</td>
                <td>Confirm GlobalG.A.P. or equivalent, schedule accredited residue tests vs EC 396/2005; prepare product specs and lot traceability SOP</td>
                <td>QA Lead</td>
                <td>Valid certificates, test reports, spec sheets</td>
            </tr>
            <tr>
                <td>1-3</td>
                <td>Buyer list and outreach</td>
                <td>Build list of 60 to 80 buyers across DE, NL, FR wholesalers and retailers, plus UK and UAE or SG importers; initiate outreach with offers and availability calendar</td>
                <td>Sales Lead</td>
                <td>Qualified pipeline with 20+ active conversations</td>
            </tr>
            <tr>
                <td>2-6</td>
                <td>EU pilot shipments</td>
                <td>Execute 8 to 12 sample and small-batch deliveries to wholesale markets and select retailers; monitor temperature and quality</td>
                <td>Ops Lead</td>
                <td>Delivery reports, shrink data, buyer feedback</td>
            </tr>
            <tr>
                <td>3-6</td>
                <td>Non-EU pilot shipments</td>
                <td>Send 1 to 2 UK and 1 UAE or SG test consignments; complete import documentation and post-arrival QC</td>
                <td>Export Lead</td>
                <td>Landed cost analysis, importer feedback</td>
            </tr>
            <tr>
                <td>1-6</td>
                <td>Branding and packaging</td>
                <td>Finalize premium and value pack SKUs, labels, and QR code traceability page; ensure multilingual origin labeling</td>
                <td>Marketing Lead</td>
                <td>Ready-to-order packaging and digital assets</td>
            </tr>
            <tr>
                <td>4-8</td>
                <td>Channel negotiation</td>
                <td>Convert pilots to recurring weekly programs with at least 3 buyers; set price mechanisms and volume ramps</td>
                <td>Sales Lead</td>
                <td>3 signed supply programs</td>
            </tr>
            <tr>
                <td>6-10</td>
                <td>Scale and optimization</td>
                <td>Expand to additional EU cities; refine post-harvest handling to improve shelf life; consolidate carrier selection</td>
                <td>Ops Lead</td>
                <td>Improved on-shelf performance KPIs</td>
            </tr>
            <tr>
                <td>8-12</td>
                <td>Review and next steps</td>
                <td>Evaluate pilots, profitability by route, and buyer performance; decide to scale in EU and one non-EU hub</td>
                <td>Management</td>
                <td>Go-forward plan and budget for next quarter</td>
            </tr>
        </table>
        <p>Sources &amp; References</p>
        <ul>
            <li>European Commission, General Food Law Regulation (EC) No 178/2002. EUR-Lex. Consolidated text, latest access 2024 to 2025.</li>
            <li>European Commission, Regulation (EC) No 852/2004 on the hygiene of foodstuffs. EUR-Lex. Consolidated text, accessed 2024 to 2025.</li>
            <li>European Commission, Regulation (EC) No 396/2005 on maximum residue levels of pesticides in or on food and feed of plant and animal origin. EU MRL database. Updated periodically, accessed 2024 to 2025.</li>
            <li>European Commission, Commission Implementing Regulation (EU) No 543/2011 laying down detailed rules for the application of Council Regulation (EC) No 1234/2007 in respect of the fruit and vegetables and processed fruit and vegetables sectors, including marketing standards for tomatoes. EUR-Lex. Accessed 2024.</li>
            <li>Regulation (EU) No 1169/2011 on the provision of food information to consumers. EUR-Lex. Accessed 2024 to 2025.</li>
            <li>Regulation (EU) 2016/679 General Data Protection Regulation. EUR-Lex. Accessed 2024 to 2025.</li>
            <li>European Commission, The Single Market. Official portal. Accessed 2024 to 2025.</li>
            <li>UK Government, Importing food and drink into the UK and IPAFFS guidance. GOV.UK. 2023 to 2025.</li>
            <li>Singapore Food Agency, Import requirements for fruits and vegetables. SFA. 2023 to 2025.</li>
            <li>Saudi Food and Drug Authority and national GCC authorities, fresh produce import requirements. Official portals. 2023 to 2025.</li>
            <li>United States Food and Drug Administration, FSMA Produce Safety Rule and FSVP. FDA.gov. 2023 to 2025.</li>
            <li>United States Department of Agriculture, APHIS import requirements for fresh tomatoes. USDA APHIS. 2023 to 2025.</li>
        <p>Data limitation note: Public sources do not provide disaggregated, verified retail value data specifically for cherry tomatoes by country for 2023 to 2025. All TAM, SAM, SOM values above are estimates derived from reasonable category share assumptions and should be validated through direct buyer data and pilot results.</p>
        </ul>
        <div class="footer">
            <p>This report was generated using AI-powered market research technology.</p>
            <p>For questions or additional analysis, please contact your research team.</p>
        </div>
    </div>
    
    <script>
        // Define the function immediately when script loads
        function downloadPDF() {
            const element = document.getElementById('report-content');
            
            // Show loading state
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '⏳ Generating PDF...';
            btn.disabled = true;
           
           // Wait for fonts and images to load
           setTimeout(function() {
               // First, ensure the element is visible and has content
               if (!element || element.offsetHeight === 0 || element.offsetWidth === 0) {
                   alert('Report content not found. Please refresh the page and try again.');
                   btn.innerHTML = originalText;
                   btn.disabled = false;
                   return;
               }
               
               // Ensure the element is visible and has content
               const rect = element.getBoundingClientRect();
               if (rect.width === 0 || rect.height === 0) {
                   alert('Report content is not visible. Please scroll to the report and try again.');
                   btn.innerHTML = originalText;
                   btn.disabled = false;
                   return;
               }
               
               // Force a reflow to ensure content is rendered
               element.style.display = 'none';
               element.offsetHeight; // Trigger reflow
               element.style.display = 'block';
               
               // Ensure all content is visible and expanded
               element.style.height = 'auto';
               element.style.minHeight = '100vh';
               element.style.overflow = 'visible';
               
               // Wait a bit more for any dynamic content to render
               setTimeout(function() {
               
               const opt = {
                   margin: [0.5, 0.5, 0.5, 0.5],
                   filename: 'AI_Trade_Report.pdf',
                   image: { type: 'jpeg', quality: 0.98 },
                   html2canvas: { 
                       scale: 1.2,
                       useCORS: true,
                       allowTaint: true,
                       backgroundColor: '#ffffff',
                       logging: false,
                       letterRendering: true,
                       width: element.scrollWidth,
                       height: element.scrollHeight,
                       scrollX: 0,
                       scrollY: 0,
                       windowWidth: element.scrollWidth,
                       windowHeight: element.scrollHeight
                   },
                   jsPDF: { 
                       unit: 'in', 
                       format: 'a4', 
                       orientation: 'portrait',
                       compress: true
                   },
                   pagebreak: { mode: ['css', 'legacy'] }
               };
              
              // Debug: Log element dimensions
              console.log('Element dimensions:', {
                  width: element.offsetWidth,
                  height: element.offsetHeight,
                  scrollWidth: element.scrollWidth,
                  scrollHeight: element.scrollHeight,
                  rect: element.getBoundingClientRect()
              });
              
              // Try the main PDF generation
              html2pdf().set(opt).from(element).save().then(function() {
                  btn.innerHTML = originalText;
                  btn.disabled = false;
              }).catch(function(error) {
                  console.error('PDF generation failed:', error);
                  
                  // Fallback: Try with simpler options
                  const simpleOpt = {
                      margin: 0.5,
                      filename: 'AI_Trade_Report.pdf',
                      image: { type: 'jpeg', quality: 0.8 },
                      html2canvas: { 
                          scale: 1,
                          backgroundColor: '#ffffff',
                          width: element.scrollWidth,
                          height: element.scrollHeight,
                          useCORS: true,
                          scrollX: 0,
                          scrollY: 0
                      },
                      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
                  };
                  
                  html2pdf().set(simpleOpt).from(element).save().then(function() {
                      btn.innerHTML = originalText;
                      btn.disabled = false;
                  }).catch(function(fallbackError) {
                      console.error('Fallback PDF generation also failed:', fallbackError);
                      alert('PDF generation failed. Please use the Print button and save as PDF from your browser instead.');
                      btn.innerHTML = originalText;
                      btn.disabled = false;
                  });
              });
          }, 500);
      }, 1000);
  }
  
  // Also make it available on window object
  window.downloadPDF = downloadPDF;
  
  // Save report function
  // Track if report is saved
  let isReportSaved = false;
  
  function saveReport() {
      console.log('Save report function called');
      
      const btn = event.target.closest('.action-btn');
      if (!btn) {
          console.error('Save button not found');
          return;
      }
      
      // Check if already saved
      if (isReportSaved) {
          btn.innerHTML = '✅ Already Saved';
          btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
          btn.disabled = true;
          
          setTimeout(() => {
              btn.innerHTML = '💾 Save';
              btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
              btn.disabled = false;
          }, 2000);
          return;
      }
      
      const originalText = btn.innerHTML;
      
      // Show loading state
      btn.innerHTML = '⏳ Saving...';
      btn.disabled = true;
      
      try {
          // Get report data
          const reportTitle = document.querySelector('h1')?.textContent || 'AI Trade Report';
          const reportContent = document.getElementById('report-content')?.innerHTML || '';
          const currentUrl = window.location.pathname;
          const filename = currentUrl.split('/').pop() || 'unknown_report.html';
          
          console.log('Report data extracted:', {
              title: reportTitle,
              filename: filename,
              contentLength: reportContent.length
          });
          
          // Extract report metadata from URL or page
          const brand = document.querySelector('.summary-item:nth-child(1) .item-value')?.textContent || 'Unknown Brand';
          const product = document.querySelector('.summary-item:nth-child(2) .item-value')?.textContent || 'Unknown Product';
          const budget = document.querySelector('.summary-item:nth-child(3) .item-value')?.textContent || 'Unknown Budget';
          const enterpriseSize = document.querySelector('.summary-item:nth-child(4) .item-value')?.textContent || 'Unknown Size';
          
          // Prepare data for API
          const reportData = {
              title: reportTitle,
              brand: brand,
              product: product,
              budget: budget,
              enterprise_size: enterpriseSize,
              ai_model: 'gpt-5',
              language: 'en',
              content: reportContent,
              file_path: filename
          };
          
          console.log('Sending data to API:', reportData);
          
          // Send to database
          fetch('/save-report', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify(reportData)
          })
          .then(response => {
              console.log('API response status:', response.status);
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
          })
          .then(data => {
              console.log('API response data:', data);
              if (data.status === 'success') {
                  isReportSaved = true; // Mark as saved
                  btn.innerHTML = '✅ Saved!';
                  btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                  
                  setTimeout(() => {
                      btn.innerHTML = '💾 Save';
                      btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
                      btn.disabled = false;
                  }, 2000);
              } else {
                  throw new Error(data.message || 'Failed to save report');
              }
          })
          .catch(error => {
              console.error('Error saving report:', error);
              btn.innerHTML = '❌ Error';
              btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
              
              setTimeout(() => {
                  btn.innerHTML = originalText;
                  btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
                  btn.disabled = false;
              }, 3000);
          });
      } catch (error) {
          console.error('Error in saveReport function:', error);
          btn.innerHTML = '❌ Error';
          btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
          
          setTimeout(() => {
              btn.innerHTML = originalText;
              btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
              btn.disabled = false;
          }, 3000);
      }
  }
  
  // Return to main page function
  function returnToMain() {
      if (isReportSaved) {
          // If report is saved, go directly without warning
          window.location.href = '/';
      } else {
          // If not saved, show warning
          if (confirm('Are you sure you want to return to the main page? Your current report will be lost.')) {
              window.location.href = '/';
          }
      }
  }
  
  // Make functions available globally
  window.saveReport = saveReport;
  window.returnToMain = returnToMain;
 
          // Hide header when printing
  window.addEventListener('beforeprint', function() {
      const header = document.querySelector('.report-header');
      if (header) header.style.display = 'none';
  });
  
  window.addEventListener('afterprint', function() {
      const header = document.querySelector('.report-header');
      if (header) header.style.display = 'block';
  });
  
  // Ensure function is available when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
      // Function should be available now
      if (typeof downloadPDF === 'function') {
          console.log('downloadPDF function is ready');
      } else {
          console.error('downloadPDF function not properly defined');
      }
  });
  
  // Also try to make it available immediately
  if (typeof downloadPDF === 'function') {
      console.log('downloadPDF function loaded successfully');
  }
    </script>
</body>
</html>