<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Trade Report - Professional Market Analysis</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        html, body {
            font-family: 'Times New Roman', serif;
            font-size: 12pt;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            width: 100%;
            min-width: 100%;
            box-sizing: border-box;
        }
        .container {
            width: 100vw;
            min-width: 100%;
            margin: 0;
            background: white;
            padding: 40px;
            border-radius: 0;
            box-shadow: none;
            box-sizing: border-box;
        }
        h1 {
            color: #2c3e50;
            font-weight: bold;
            font-size: 18pt;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            font-weight: bold;
            font-size: 16pt;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        h3 {
            color: #2c3e50;
            font-weight: bold;
            font-size: 14pt;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        h4 {
            color: #7f8c8d;
            font-weight: bold;
            font-size: 12pt;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        ul, ol {
            margin-bottom: 15px;
            padding-left: 30px;
            line-height: 1.5;
        }
        li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        /* Professional bullet points */
        ul li {
            list-style-type: disc;
            margin-left: 20px;
        }
        ul ul li {
            list-style-type: circle;
        }
        ul ul ul li {
            list-style-type: square;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e8f4f8;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .summary-box {
            background-color: #d4edda;
            padding: 20px;
            border-left: 4px solid #28a745;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 20px 0;
            border-radius: 4px;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        /* Professional Report Header */
        .report-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.25rem;
            color: #1f2937;
        }
        .header-brand .brand-icon {
            font-size: 1.5rem;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header-actions {
            display: flex;
            gap: 0.75rem;
        }
        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .action-btn:active {
            transform: translateY(0);
        }
        .action-btn.print {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .action-btn.pdf {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        /* Hide download button on mobile devices */
        @media (max-width: 768px) {
            .action-btn.pdf {
                display: none !important;
            }
        }
        .action-btn.save {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        .action-btn.home {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .btn-icon {
            font-size: 1rem;
        }
        .btn-text {
            font-size: 0.875rem;
        }
        
        /* Report Title Section */
        .report-title-section {
            text-align: center;
            margin-bottom: 2rem;
            padding-top: 6rem;
        }
        .title-underline {
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #2563eb, #7c3aed);
            margin: 1rem auto 0;
            border-radius: 2px;
        }
        
        /* Enhanced Summary Box */
        .summary-box {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #bae6fd;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .summary-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #0369a1;
            font-size: 1.125rem;
        }
        .summary-icon {
            font-size: 1.25rem;
        }
        .summary-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .summary-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .item-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .item-value {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }
                 @media print {
             body { 
                 background-color: white !important; 
                 color: black !important;
                 font-size: 12pt;
                 line-height: 1.4;
                 margin: 0 !important;
                 padding: 0 !important;
                 width: 100% !important;
             }
             .container { 
                 box-shadow: none !important; 
                 background: white !important;
                 padding: 20px !important;
                 margin: 0 !important;
                 width: 100% !important;
                 min-width: 100% !important;
                 max-width: none !important;
                 box-sizing: border-box !important;
                 height: auto !important;
                 min-height: 100vh !important;
             }
             .report-header { display: none !important; }
             .action-buttons { display: none !important; }
             h1, h2, h3, h4 { 
                 color: black !important; 
                 page-break-after: avoid;
                 page-break-inside: avoid;
             }
             table { 
                 page-break-inside: avoid; 
                 border-collapse: collapse !important;
             }
             .summary-box, .highlight, .warning-box {
                 background: #f8f9fa !important;
                 border: 1px solid #ddd !important;
                 color: black !important;
                 page-break-inside: avoid;
             }
             p, li {
                 page-break-inside: avoid;
                 orphans: 3;
                 widows: 3;
             }
             .footer {
                 page-break-inside: avoid;
             }
         }
        /* ===== MOBILE RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .header-content {
                padding: 0 1.5rem;
            }
            .container {
                padding: 30px;
            }
        }
        
        @media (max-width: 768px) {
            /* Mobile Header */
            .report-header {
                padding: 0.75rem 0;
            }
            .header-content {
                padding: 0 1rem;
                flex-direction: column;
                gap: 0.75rem;
                align-items: center;
            }
            .header-brand {
                font-size: 1.125rem;
            }
            .header-actions {
                width: 100%;
                justify-content: center;
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            .action-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
                flex: 1;
                max-width: 120px;
                display: flex;
                align-items: center;
                gap: 0.375rem;
            }
            .btn-text {
                font-size: 0.8125rem;
                display: inline !important;
            }
            
            /* Mobile Container */
            .container {
                padding: 20px 15px;
                margin-top: 120px; /* Account for taller mobile header */
            }
            
            /* Mobile Typography */
            h1 {
                font-size: 1.75rem;
                margin-bottom: 20px;
            }
            h2 {
                font-size: 1.375rem;
                margin-top: 25px;
                margin-bottom: 15px;
            }
            h3 {
                font-size: 1.125rem;
                margin-top: 20px;
                margin-bottom: 12px;
            }
            h4 {
                font-size: 1rem;
                margin-top: 15px;
                margin-bottom: 8px;
            }
            p {
                font-size: 0.9375rem;
                line-height: 1.6;
                margin-bottom: 12px;
            }
            
            /* Mobile Tables */
            table {
                font-size: 0.875rem;
                margin: 15px 0;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            th, td {
                padding: 8px 6px;
                min-width: 80px;
            }
            th {
                font-size: 0.8125rem;
            }
            
            /* Mobile Lists */
            ul, ol {
                padding-left: 20px;
                margin-bottom: 12px;
            }
            li {
                font-size: 0.9375rem;
                margin-bottom: 6px;
                line-height: 1.5;
            }
            
            /* Mobile Boxes */
            .summary-box, .highlight, .warning-box {
                padding: 15px;
                margin: 15px 0;
                border-radius: 8px;
            }
            .summary-content {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            .summary-item {
                padding: 8px 0;
            }
            .item-label {
                font-size: 0.8125rem;
            }
            .item-value {
                font-size: 0.9375rem;
            }
            
            /* Mobile Code Blocks */
            .code-block {
                padding: 12px;
                font-size: 0.8125rem;
                margin: 12px 0;
                border-radius: 6px;
            }
            
            /* Mobile Footer */
            .footer {
                margin-top: 30px;
                padding-top: 15px;
                font-size: 0.8125rem;
            }
        }
        
        @media (max-width: 480px) {
            /* Extra Small Mobile */
            .container {
                padding: 15px 10px;
                margin-top: 140px;
            }
            
            .header-content {
                padding: 0 0.75rem;
            }
            .header-brand {
                font-size: 1rem;
            }
            .action-btn {
                padding: 0.375rem 0.5rem;
                font-size: 0.6875rem;
                max-width: 100px;
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }
            .btn-text {
                font-size: 0.75rem;
                display: inline !important;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            h2 {
                font-size: 1.25rem;
            }
            h3 {
                font-size: 1.0625rem;
            }
            
            table {
                font-size: 0.8125rem;
            }
            th, td {
                padding: 6px 4px;
                min-width: 70px;
            }
            
            .summary-box, .highlight, .warning-box {
                padding: 12px;
                margin: 12px 0;
            }
            
            .code-block {
                padding: 10px;
                font-size: 0.75rem;
            }
        }
        
        /* Mobile Print Optimizations */
        @media print and (max-width: 768px) {
            .container {
                padding: 15px !important;
                margin: 0 !important;
                width: 100% !important;
            }
            h1, h2, h3, h4 {
                page-break-after: avoid;
                font-size: 1.2em;
            }
            table {
                font-size: 0.8em;
                page-break-inside: avoid;
            }
            .summary-box, .highlight, .warning-box {
                page-break-inside: avoid;
                margin: 10px 0;
            }
        }
        @media screen {
            body {
                margin: 0;
                padding: 0;
            }
        }
        
        /* Saved Reports Section Styles */
        .saved-reports-section {
            padding: 2rem 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 400px;
        }
        
        .saved-reports-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 0 auto;
            max-width: 1200px;
        }
        
        .saved-reports-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .saved-reports-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .title-icon {
            font-size: 1.5rem;
        }
        
        .saved-reports-subtitle {
            color: #64748b;
            font-size: 1rem;
            margin: 0;
        }
        
        .saved-reports-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .saved-report-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .saved-report-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }
        
        .saved-report-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        }
        
        .report-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .report-item-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
            line-height: 1.4;
        }
        
        .report-item-date {
            font-size: 0.875rem;
            color: #64748b;
            white-space: nowrap;
        }
        
        .report-item-details {
            margin-bottom: 1rem;
        }
        
        .report-detail-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .report-detail-label {
            font-weight: 500;
            color: #475569;
            min-width: 80px;
            margin-right: 0.5rem;
        }
        
        .report-detail-value {
            color: #1e293b;
            flex: 1;
        }
        
        .report-item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .report-action-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
        }
        
        .report-action-btn.primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .report-action-btn.primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
        }
        
        .report-action-btn.secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }
        
        .report-action-btn.secondary:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
        }
        
        .no-reports-message {
            text-align: center;
            padding: 3rem 2rem;
            color: #64748b;
        }
        
        .no-reports-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .no-reports-message h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #475569;
            margin-bottom: 0.5rem;
        }
        
        .no-reports-message p {
            font-size: 1rem;
            margin: 0;
        }
        
        .saved-reports-toggle {
            background: none;
            border: none;
            color: inherit;
            font-size: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .saved-reports-toggle:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .saved-reports-toggle.active {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }
        
        .nav-icon {
            font-size: 1rem;
        }
        
        /* Mobile Responsive for Saved Reports */
        @media (max-width: 768px) {
            .saved-reports-list {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .saved-report-item {
                padding: 1rem;
            }
            
            .report-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .report-item-actions {
                flex-direction: column;
            }
            
            .saved-reports-card {
                padding: 1.5rem;
                margin: 0 1rem;
            }
            
        .saved-reports-title {
            font-size: 1.5rem;
        }
    }
    
    /* Loading and Error States */
    .loading-reports {
        text-align: center;
        padding: 2rem;
        color: #64748b;
        font-size: 1rem;
    }
    
        .error-message {
        text-align: center;
        padding: 2rem;
        color: #dc2626;
        font-size: 1rem;
        }

        /* Custom styles for Bootstrap modal enhancements */
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-header .btn-close {
            filter: invert(1);
        }

        .sortable {
            cursor: pointer;
            user-select: none;
        }

        .sortable:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sort-indicator {
            margin-left: 8px;
            opacity: 0.5;
            transition: all 0.2s ease;
        }

        .sortable.asc .sort-indicator {
            opacity: 1;
            transform: rotate(180deg);
        }

        .sortable.desc .sort-indicator {
            opacity: 1;
        }

        /* Custom Navbar Styles */
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 0.75rem 0;
        }

        .navbar-brand {
            font-size: 1.5rem;
            color: #333 !important;
        }

        .navbar-brand .brand-logo-img {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .navbar-nav .btn {
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            padding: 0.5rem 1rem;
        }

        .navbar-nav .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .navbar-nav .btn-outline-primary:hover {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        .navbar-nav .btn-outline-secondary:hover {
            background-color: #6c757d;
            border-color: #6c757d;
        }

        .navbar-nav .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        /* Responsive navbar */
        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1.25rem;
            }
            
            .navbar-nav .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }
            
            .navbar-nav {
                margin-top: 1rem;
            }
        }

        /* Scrollable Table Styles */
        .table-responsive {
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .table-responsive::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .table-responsive::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .sticky-top {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table th {
            white-space: nowrap;
            font-weight: 600;
        }

        .table td {
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <!-- Professional Report Header -->
    <header class="report-header">
        <div class="header-content">
            <div class="header-brand">
                <img src="/static/logo_trade_on_chain.png" alt="AI Trade Report" class="brand-logo" style="height: 32px; width: auto; margin-right: 12px;">
                <img src="/static/logo2.png" alt="AI Trade Report" class="brand-logo" style="height: 32px; width: auto; margin-right: 12px;">
                <span class="brand-text">AI Trade Report</span>
            </div>
            <div class="header-actions">
                <button class="action-btn save" onclick="saveReport()">
                    <span class="btn-icon">💾</span>
                    <span class="btn-text">Save</span>
                </button>
                <button class="action-btn home" onclick="returnToMain()">
                    <span class="btn-icon">🏠</span>
                    <span class="btn-text">Home</span>
                </button>
                <button class="action-btn print" onclick="window.print()">
                    <span class="btn-icon">🖨️</span>
                    <span class="btn-text">Print</span>
                </button>
                <button class="action-btn pdf" onclick="downloadPDF()">
                    <span class="btn-icon">📄</span>
                    <span class="btn-text">Download PDF</span>
                </button>
            </div>
        </div>
    </header>
    
    <div class="container" id="report-content">
        <div class="report-title-section">
            <h1>AI Trade Report</h1>
            <div class="title-underline"></div>
        </div>
        <div class="summary-box">
            <div class="summary-header">
                <span class="summary-icon">📋</span>
                <span class="summary-title">Report Overview</span>
            </div>
            <div class="summary-content">
                <div class="summary-item">
                    <span class="item-label">Generated by:</span>
                    <span class="item-value">AI-Powered Market Research</span>
                </div>
                <div class="summary-item">
                    <span class="item-label">Date:</span>
                    <span class="item-value">28 September 2025</span>
                </div>
                <div class="summary-item">
                    <span class="item-label">Report Type:</span>
                    <span class="item-value">Comprehensive Market Analysis</span>
                </div>
            </div>
        </div>
        <p>Title: Strategic Market Analysis Report for Kathetostoma giganteum under the brand “tomato”</p>
        <p>Analysis Date: 28 September 2025</p>
        <p>Font: Times New Roman, 12pt | Line spacing: 1.5 | Margins: 1 inch | Page numbers: Bottom center</p>
        <br>
        <p>Executive Summary</p>
        <ul>
            <li>Objective: Assess market expansion opportunities for fish of the species Kathetostoma giganteum under the brand “tomato” for a small enterprise across European and non-European markets, with compliant route-to-market, risk controls, and an investment-grade budget recommendation.</li>
            <li>Key finding: There is insufficient verifiable, product-specific market size data publicly available from mandated sources for Kathetostoma giganteum as a distinct reported commodity category in EU or global trade datasets. Most official trade systems aggregate at HS-6 to HS-8 levels for “fish” categories that do not isolate this species. Consequently, all market size figures must be treated as directional estimates derived from adjacent whitefish and niche demersal categories, clearly labeled as Estimate. Regulatory pathways, distribution models, and risk parameters are well defined and actionable.</li>
            <li>Strategic stance: Enter through high-value niche channels that reward species differentiation and story-telling rather than mainstream volume retail. Prioritize European Union single market access via a single EU entry point, then expand to the United Kingdom and selected non-EU premium markets in Asia-Pacific and North America via specialized importers. Adopt a staged market test in 90 days with tight working capital rotation and strict quality and labeling compliance.</li>
        </ul>
        <p>Market Overview</p>
        <p>Data availability note: No official EU, UN Comtrade, or FAO FishStatJ dataset isolates Kathetostoma giganteum as a distinct trade line item at HS-6. Therefore, references to demand, pricing, and channel behavior are inferred from the broader categories of demersal marine fish and niche species programs in premium HORECA and specialty retail. All quantitative values below are Estimates and are presented with transparent rationale.</p>
        <br>
        <ul>
            <li>Category definition: Kathetostoma giganteum is a demersal marine species. For customs and trade, likely classified under general fish categories at HS-03 headings depending on product form: whole, fillets, fresh, chilled, or frozen. Product positioning will align with niche whitefish used in premium culinary applications, emphasizing sustainability, traceability, and chef-led adoption.</li>
            <li>Global demand context (Estimate): Premium niche demersal fish in HORECA and specialty retail segments represent a small fraction of total whitefish trade volumes, but command higher price points per kg. Entry opportunity exists where buyers seek differentiated species to refresh menus and counters.</li>
        </ul>
        <p>Target Market Analysis</p>
        <p>Data constraints: Species-specific TAM/SAM/SOM are not directly reported by official sources. The table below provides directional Estimates using the accessible premium-demersal niche segment share within broader fish consumption in each market, anchored by population size, per capita fish consumption from FAO/OECD where available historically, and the expected adoption rate for a new species within premium channels for a small enterprise in year 1.</p>
        <br>
        <table>
            <tr>
                <td>Country</td>
                <td>TAM (Estimate)</td>
                <td>SAM (Estimate)</td>
                <td>SOM Year 1 (Estimate)</td>
            </tr>
            <tr>
                <th>---------</th>
                <th>----------------</th>
                <th>----------------</th>
                <th>----------------------</th>
            </tr>
            <tr>
                <td>Germany</td>
                <td>120-180 EUR M</td>
                <td>30-45 EUR M</td>
                <td>0.3-0.9 EUR M</td>
            </tr>
            <tr>
                <td>France</td>
                <td>140-200 EUR M</td>
                <td>35-50 EUR M</td>
                <td>0.3-1.0 EUR M</td>
            </tr>
            <tr>
                <td>UK</td>
                <td>130-190 EUR M</td>
                <td>30-45 EUR M</td>
                <td>0.3-0.9 EUR M</td>
            </tr>
            <tr>
                <td>Italy</td>
                <td>110-160 EUR M</td>
                <td>25-40 EUR M</td>
                <td>0.2-0.7 EUR M</td>
            </tr>
            <tr>
                <td>Spain</td>
                <td>120-170 EUR M</td>
                <td>25-40 EUR M</td>
                <td>0.2-0.7 EUR M</td>
            </tr>
            <tr>
                <td>Netherlands</td>
                <td>70-100 EUR M</td>
                <td>18-28 EUR M</td>
                <td>0.2-0.6 EUR M</td>
            </tr>
            <tr>
                <td>Poland</td>
                <td>50-80 EUR M</td>
                <td>10-18 EUR M</td>
                <td>0.1-0.4 EUR M</td>
            </tr>
            <tr>
                <td>United States</td>
                <td>300-420 EUR M</td>
                <td>75-110 EUR M</td>
                <td>0.5-1.5 EUR M</td>
            </tr>
            <tr>
                <td>Canada</td>
                <td>60-90 EUR M</td>
                <td>15-25 EUR M</td>
                <td>0.1-0.4 EUR M</td>
            </tr>
            <tr>
                <td>Japan</td>
                <td>220-320 EUR M</td>
                <td>55-85 EUR M</td>
                <td>0.4-1.2 EUR M</td>
            </tr>
            <tr>
                <td>South Korea</td>
                <td>120-170 EUR M</td>
                <td>30-45 EUR M</td>
                <td>0.2-0.8 EUR M</td>
            </tr>
            <tr>
                <td>Singapore</td>
                <td>30-45 EUR M</td>
                <td>8-12 EUR M</td>
                <td>0.05-0.2 EUR M</td>
            </tr>
            <tr>
                <td>UAE</td>
                <td>35-50 EUR M</td>
                <td>9-13 EUR M</td>
                <td>0.05-0.2 EUR M</td>
            </tr>
        </table>
        <p>Estimate rationale:</p>
        <ul>
            <li>TAM: Premium and niche demersal fish spend accessible to new species within total fish consumption, derived proportionally from historical FAO per capita consumption patterns for high-income markets and adjusted for premium channel mix. Not species-specific due to lack of reported granularity.</li>
            <li>SAM: Addressable through specialty importers, premium retail, and HORECA with realistic access for a small enterprise in first 24 months via 1 to 2 import partners per market.</li>
            <li>SOM Year 1: Constrained by supply, listings, and chef adoption cycles; assumes 10 to 50 metric tons total across priority markets at a blended ex-works 7 to 12 EUR per kg depending on form and yield. All monetary figures are directional Estimates.</li>
        </ul>
        <p>Competitive Landscape</p>
        <p>Data availability note: No official datasets isolate competitors by species. The competitive frame is the set of niche demersal offerings competing for menu space and retail rotation.</p>
        <br>
        <table>
            <tr>
                <td>Company</td>
                <td>Market Share</td>
                <td>Strengths</td>
                <td>Weaknesses</td>
            </tr>
            <tr>
                <th>---------</th>
                <th>--------------</th>
                <th>-----------</th>
                <th>------------</th>
            </tr>
            <tr>
                <td>Niche importers and distributors in EU single market (e.g., premium seafood specialists)</td>
                <td>Not publicly reported</td>
                <td>Established HORECA networks, cold chain, QA systems</td>
                <td>Limited bandwidth for new SKUs without demand proof</td>
            </tr>
            <tr>
                <td>Large whitefish suppliers operating cod, hake, monkfish programs</td>
                <td>Not publicly reported</td>
                <td>Scale, stable supply, known species</td>
                <td>Less flexible on small volumes, lower incentive to push niche species</td>
            </tr>
            <tr>
                <td>Local artisanal fisheries in destination markets</td>
                <td>Not publicly reported</td>
                <td>Freshness, origin trust</td>
                <td>Limited continuity and volume for national programs</td>
            </tr>
        </table>
        <p>Note: Market shares are not provided due to unavailable official, verifiable data. Competitive dynamics are qualitative and channel-based.</p>
        <br>
        <p>Regulatory Environment</p>
        <ul>
            <li>European Union food safety and labeling</li>
            <li>General Food Law Regulation (EC) No 178/2002 sets principles for food safety in the EU.</li>
            <li>Regulation (EU) No 1169/2011 on the provision of food information to consumers governs labeling, including species name, production method, catch area for fishery products at retail.</li>
            <li>Regulation (EC) No 853/2004 sets specific hygiene rules for food of animal origin, including fishery products.</li>
            <li>IUU Regulation (Council Regulation (EC) No 1005/2008) for catch certification to prevent illegal, unreported, and unregulated fishing.</li>
            <li>Official source: European Commission food safety portal. Publication years: as cited above, consolidated versions active 2024 to 2025.</li>
            <li>UK post-Brexit</li>
            <li>UK Food Information Regulations mirror EU 1169/2011 in domestic law, with country of origin and species labeling requirements. Import controls via IPAFFS and health certificates for fishery products.</li>
            <li>Official source: UK Food Standards Agency, UK GOV import guidance, 2024 to 2025.</li>
            <li>United States</li>
            <li>FDA seafood HACCP (21 CFR Part 123), Foreign Supplier Verification Programs under FSMA, NOAA Seafood Import Monitoring Program for specific species lists. Species applicability must be verified; if not listed under SIMP, standard entry applies with FDA prior notice and HACCP. Sources: FDA, NOAA, 2024 to 2025.</li>
            <li>Canada</li>
            <li>Safe Food for Canadians Regulations, fish import licensing, labeling in English and French. Source: CFIA, 2024 to 2025.</li>
            <li>Japan</li>
            <li>Food Sanitation Act import notifications, residue and contaminant standards. Source: MHLW, 2024 to 2025.</li>
            <li>Gulf markets</li>
            <li>Gulf Standardization Organization food labeling, halal certification where applicable for processing aids; import permits vary by country. Sources: national food authorities, 2023 to 2025.</li>
        </ul>
        <p>Consumer Analysis</p>
        <ul>
            <li>European premium seafood buyers increasingly value traceability, sustainability certifications, and clear species labeling. Chef-driven discovery is a primary path for unfamiliar species adoption in France, UK, Germany, Netherlands, Spain, and Italy. Official EU surveys document trust in labeling and origin for fishery products, but not species-specific to Kathetostoma giganteum. Source: European Commission consumer studies on fishery product labeling and origin trust, 2023 to 2024.</li>
            <li>Non-European high-potential markets like Japan and South Korea show strong acceptance of diverse marine species and high per capita consumption in HORECA and retail sashimi or cooking formats. FAO and OECD long-run data support robust seafood demand, but no species-level data is available for Kathetostoma giganteum. Sources: FAO, OECD 2023 to 2024.</li>
        </ul>
        <p>Distribution Channels</p>
        <ul>
            <li>EU: Use a single importer in the Netherlands or Germany to leverage logistics hubs and EU single market movement following veterinary border control at first point of entry. Channels: premium HORECA distributors, specialty fishmongers, and upscale supermarket fresh counters for limited regional pilots.</li>
            <li>UK: Appoint a UK seafood importer-distributor with HORECA reach, manage Border Target Operating Model requirements and health certificates.</li>
            <li>North America: Two-step model via specialty importers servicing coastal cities with chef networks.</li>
            <li>Asia-Pacific: Japan and South Korea via established seafood importers specializing in niche species; Singapore as a regional hub for Southeast Asia pilots.</li>
            <li>Middle East: Dubai and Abu Dhabi through premium seafood distributors serving hotels and fine dining, with temperature-controlled airfreight.</li>
        </ul>
        <p>Pricing Strategy and Cost Structure</p>
        <ul>
            <li>Positioning: Premium niche whitefish alternative, priced to reward novelty and quality while remaining competitive with monkfish, hake, or grouper in premium HORECA.</li>
            <li>Estimate ex-works pricing benchmarks: 7 to 12 EUR per kg depending on cut, glaze, and pack; HORECA distributor selling price can reach 12 to 20 EUR per kg depending on market and form. These are directional Estimates referencing comparable niche demersal pricing bands observed in premium channels; no official price series exists for this species.</li>
            <li>Cost drivers: Raw material cost and yield, processing, freezing or cold chain, certification and testing, airfreight or reefer costs, import duties and fees, distributor margin, promotional allowances.</li>
        </ul>
        <p>Risk Assessment</p>
        <ul>
            <li>Data gaps: Lack of species-specific official statistics complicates TAM/SAM/SOM precision and benchmarking.</li>
            <li>Regulatory: Catch documentation, IUU compliance, import health certificates, labeling in local languages; SIMP species applicability in the US must be confirmed prior to shipment.</li>
            <li>Supply: Seasonal variability, yields, and continuity; small enterprise exposure to buyer concentration risk.</li>
            <li>Market: Unfamiliar species may require sustained chef education and sampling; delisting risk if rotation is slow.</li>
            <li>Currency: EUR versus USD, JPY, GBP volatility impacting landed costs and pricing.</li>
            <li>Logistics: Cold chain integrity, airfreight capacity and costs for initial volumes; potential customs delays.</li>
            <li>Mitigations: Signed supply MOUs, pre-clearance with import authorities, batch-by-batch laboratory testing for contaminants, hedging policies for major currencies, staged POs, diversified importer base.</li>
        </ul>
        <p>Budget Recommendations</p>
        <p>Note: The client did not provide a budget. The following budget is an Estimate suitable for a small enterprise initiating a controlled, multi-region pilot over 12 months. It assumes limited initial volumes, focused market development, and disciplined working capital.</p>
        <br>
        <table>
            <tr>
                <td>Budget Line</td>
                <td>EU Allocation</td>
                <td>Non-EU Allocation</td>
                <td>Total Year 1 (Estimate)</td>
                <td>Rationale</td>
            </tr>
            <tr>
                <th>-------------</th>
                <th>---------------</th>
                <th>-------------------</th>
                <th>-------------------------</th>
                <th>-----------</th>
            </tr>
            <tr>
                <td>Regulatory and compliance setup</td>
                <td>30-45 KEUR</td>
                <td>20-30 KEUR</td>
                <td>50-75 KEUR</td>
                <td>HACCP upgrades, EU listing approvals, labels, lab tests, documentation systems</td>
            </tr>
            <tr>
                <td>Certifications and audits</td>
                <td>15-25 KEUR</td>
                <td>10-15 KEUR</td>
                <td>25-40 KEUR</td>
                <td>Supplier audits, potential sustainability claims validation</td>
            </tr>
            <tr>
                <td>Product development and packaging</td>
                <td>20-30 KEUR</td>
                <td>10-15 KEUR</td>
                <td>30-45 KEUR</td>
                <td>Cut formats, packs, multi-language labels</td>
            </tr>
            <tr>
                <td>Market development and trade marketing</td>
                <td>60-90 KEUR</td>
                <td>60-90 KEUR</td>
                <td>120-180 KEUR</td>
                <td>Chef sampling, demos, shows, collateral, digital</td>
            </tr>
            <tr>
                <td>Distributor onboarding and allowances</td>
                <td>50-80 KEUR</td>
                <td>50-80 KEUR</td>
                <td>100-160 KEUR</td>
                <td>Intro discounts, slotting where applicable, launch promos</td>
            </tr>
            <tr>
                <td>Logistics and initial inventory buffer</td>
                <td>120-180 KEUR</td>
                <td>140-220 KEUR</td>
                <td>260-400 KEUR</td>
                <td>First 3 to 4 rotation cycles across hubs</td>
            </tr>
            <tr>
                <td>Contingency and currency buffer</td>
                <td>25-35 KEUR</td>
                <td>25-35 KEUR</td>
                <td>50-70 KEUR</td>
                <td>10 to 12 percent contingency on variable costs</td>
            </tr>
            <tr>
                <td>Total</td>
                <td>320-485 KEUR</td>
                <td>315-485 KEUR</td>
                <td>635-970 KEUR</td>
                <td>Year 1 controlled multi-region pilot budget</td>
            </tr>
        </table>
        <p>Assumptions:</p>
        <ul>
            <li>Volumes: 10 to 50 metric tons Year 1 across markets, staged in tranches. Estimate.</li>
            <li>Forms: Frozen fillets or HGT to manage shelf life; limited fresh by air for chef trials. Estimate.</li>
            <li>Funding: Combination of internal capital and working capital line. Estimate.</li>
        </ul>
        <p>Strategic Recommendations</p>
        <ul>
            <li>Market entry sequencing</li>
            <li>Phase 1 EU: Import via Netherlands or Germany for EU-wide access; prioritize Germany, France, Netherlands, and Spain for HORECA pilots with 5 to 8 top distributors.</li>
            <li>Parallel UK: One importer with strong HORECA presence; align labeling and health certificates.</li>
            <li>Phase 2 Asia-Pacific: Japan and South Korea through niche seafood importers after EU proof-of-rotation; Singapore as a hub test.</li>
            <li>Phase 2 North America: East and West Coast pilots via specialty importers after SIMP status confirmation.</li>
            <li>Product and value proposition</li>
            <li>Lead with chef-first story, species education, and application guides. Offer high-yield cuts and consistent specs. Provide origin and catch documentation.</li>
            <li>Develop 3 SKUs: HGT frozen 3 to 5 kg case, skinless fillets IQF 5 kg case, and chef sample packs of 1 kg. Estimate.</li>
            <li>Compliance and quality</li>
            <li>Implement full batch traceability, EU labeling per 1169/2011, IUU catch certificates, and third-party lab tests for heavy metals and histamine where applicable.</li>
            <li>Pricing and margin</li>
            <li>Set ex-works price per kg by SKU to deliver 25 to 35 percent gross margin after logistics and distributor margin, revisiting quarterly to reflect currency and freight. Estimate.</li>
            <li>Partnerships</li>
            <li>Secure written commitments from 2 EU importers, 1 UK importer, and 1 APAC importer contingent on rotation performance. Co-fund menu placements and retail tastings.</li>
            <li>Risk controls</li>
            <li>Limit initial PO size and require rolling forecasts from distributors. Hedge USD and JPY exposures when airfreighting.</li>
        </ul>
        <p>Implementation Plan</p>
        <p>90-day action plan focused on compliance, partner onboarding, and first sales</p>
        <br>
        <table>
            <tr>
                <td>Workstream</td>
                <td>Weeks 1-3</td>
                <td>Weeks 4-6</td>
                <td>Weeks 7-9</td>
                <td>Weeks 10-12</td>
                <td>Owner</td>
                <td>KPI</td>
            </tr>
            <tr>
                <th>------------</th>
                <th>-----------</th>
                <th>-----------</th>
                <th>-----------</th>
                <th>-------------</th>
                <th>-------</th>
                <th>-----</th>
            </tr>
            <tr>
                <td>Regulatory and labeling</td>
                <td>Confirm HS code by product form with customs broker; finalize EU label per 1169/2011; initiate IUU catch certificate workflow</td>
                <td>Arrange third-party lab testing protocols; build batch traceability SOPs</td>
                <td>UK import documentation templates and IPAFFS set-up</td>
                <td>US SIMP applicability written confirmation; FDA prior notice dry run</td>
                <td>QA Lead</td>
                <td>All documents approved before first shipment</td>
            </tr>
            <tr>
                <td>Supply and quality</td>
                <td>Lock supplier specs, yields, and QC checkpoints</td>
                <td>First pilot production run plan</td>
                <td>Pre-shipment inspection and temperature logging setup</td>
                <td>Post-shipment QA review and corrective actions</td>
                <td>Operations</td>
                <td>95 percent on-spec lots in pilot</td>
            </tr>
            <tr>
                <td>Distribution partners</td>
                <td>Shortlist EU and UK importers; issue product decks</td>
                <td>Secure LOIs with at least 2 EU and 1 UK partner</td>
                <td>Finalize pricing, MOQs, and rebate structures</td>
                <td>Joint launch calendars and sampling plan</td>
                <td>Commercial Lead</td>
                <td>3 importer LOIs signed</td>
            </tr>
            <tr>
                <td>Logistics</td>
                <td>Select EU first point of entry; align with BCP veterinary checks</td>
                <td>Book cold chain carriers and storage</td>
                <td>Execute first test shipment to EU</td>
                <td>Evaluate lead times and landed cost variance</td>
                <td>Logistics Manager</td>
                <td>On-time delivery within 48 hours SLA post-release</td>
            </tr>
            <tr>
                <td>Market development</td>
                <td>Build chef education toolkit, recipes, and training videos</td>
                <td>Schedule chef tastings with top 50 targets</td>
                <td>Conduct 20+ tastings; capture feedback</td>
                <td>Confirm 10 initial menu placements</td>
                <td>Marketing</td>
                <td>10 menu placements, 5 retail demos</td>
            </tr>
            <tr>
                <td>Finance and risk</td>
                <td>Set currency policy and hedging thresholds</td>
                <td>Implement landed cost calculator</td>
                <td>Monitor pilot P&amp;L, adjust price corridors</td>
                <td>Approve Phase 2 budget release</td>
                <td>CFO</td>
                <td>Gross margin within target band</td>
            </tr>
        </table>
        <p>Budget Allocation Recommendations</p>
        <ul>
            <li>Split Year 1 spend roughly 50 to 50 between EU and non-EU pilots to balance regulatory familiarity and premium demand discovery. Within non-EU, allocate 60 percent to Asia-Pacific and 40 percent to North America initially due to higher chef openness to new species in Japan and South Korea. Estimate.</li>
            <li>Reallocate after 90 days based on rotation: markets achieving 2 or more turns per quarter receive incremental working capital; underperforming channels are paused. Estimate.</li>
        </ul>
        <p>Sources &amp; References</p>
        <p>Note on data limitations: No official statistics were located that isolate Kathetostoma giganteum as a discrete commodity in trade or consumption datasets at HS-6 or above. All market size figures are directional Estimates derived from adjacent premium demersal segments and are provided with transparent caveats.</p>
        <br>
        <ul>
            <li>European Commission, Food Safety: General Food Law Regulation (EC) No 178/2002. Consolidated text accessed 2024 to 2025.</li>
            <li>European Commission, Food Information to Consumers: Regulation (EU) No 1169/2011. Consolidated text accessed 2024 to 2025.</li>
            <li>European Commission, Hygiene of Food of Animal Origin: Regulation (EC) No 853/2004. Consolidated text accessed 2024 to 2025.</li>
            <li>European Commission, Illegal, Unreported and Unregulated fishing: Council Regulation (EC) No 1005/2008. Consolidated text accessed 2024 to 2025.</li>
            <li>UK Government, Food Standards Agency: Food information and fishery products labeling guidance. Accessed 2024 to 2025.</li>
            <li>UK Government, Import of fishery products and IPAFFS guidance. Accessed 2024 to 2025.</li>
            <li>US Food and Drug Administration, Seafood HACCP, 21 CFR Part 123; Foreign Supplier Verification Programs; Prior Notice. Accessed 2024 to 2025.</li>
            <li>NOAA Fisheries, Seafood Import Monitoring Program species list and requirements. Accessed 2024 to 2025.</li>
            <li>Canadian Food Inspection Agency, Safe Food for Canadians Regulations, fish and seafood import requirements. Accessed 2024 to 2025.</li>
            <li>Japan Ministry of Health, Labour and Welfare, Food Sanitation Act import procedures. Accessed 2024 to 2025.</li>
            <li>FAO, OECD fisheries and aquaculture overview publications for per capita fish consumption trends. Latest editions accessed 2023 to 2024.</li>
            <li>European Commission consumer research on fishery product labeling and origin trust. 2023 to 2024.</li>
        </ul>
        <p>End of Report</p>
        <div class="footer">
            <p>This report was generated using AI-powered market research technology.</p>
            <p>For questions or additional analysis, please contact your research team.</p>
        </div>
    </div>
    
    <script>
        // Define the function immediately when script loads
        function downloadPDF() {
            const element = document.getElementById('report-content');
            
            // Show loading state
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '⏳ Generating PDF...';
            btn.disabled = true;
           
           // Wait for fonts and images to load
           setTimeout(function() {
               // First, ensure the element is visible and has content
               if (!element || element.offsetHeight === 0 || element.offsetWidth === 0) {
                   alert('Report content not found. Please refresh the page and try again.');
                   btn.innerHTML = originalText;
                   btn.disabled = false;
                   return;
               }
               
               // Ensure the element is visible and has content
               const rect = element.getBoundingClientRect();
               if (rect.width === 0 || rect.height === 0) {
                   alert('Report content is not visible. Please scroll to the report and try again.');
                   btn.innerHTML = originalText;
                   btn.disabled = false;
                   return;
               }
               
               // Force a reflow to ensure content is rendered
               element.style.display = 'none';
               element.offsetHeight; // Trigger reflow
               element.style.display = 'block';
               
               // Ensure all content is visible and expanded
               element.style.height = 'auto';
               element.style.minHeight = '100vh';
               element.style.overflow = 'visible';
               
               // Wait a bit more for any dynamic content to render
               setTimeout(function() {
               
               const opt = {
                   margin: [0.5, 0.5, 0.5, 0.5],
                   filename: 'AI_Trade_Report.pdf',
                   image: { type: 'jpeg', quality: 0.98 },
                   html2canvas: { 
                       scale: 1.2,
                       useCORS: true,
                       allowTaint: true,
                       backgroundColor: '#ffffff',
                       logging: false,
                       letterRendering: true,
                       width: element.scrollWidth,
                       height: element.scrollHeight,
                       scrollX: 0,
                       scrollY: 0,
                       windowWidth: element.scrollWidth,
                       windowHeight: element.scrollHeight
                   },
                   jsPDF: { 
                       unit: 'in', 
                       format: 'a4', 
                       orientation: 'portrait',
                       compress: true
                   },
                   pagebreak: { mode: ['css', 'legacy'] }
               };
              
              // Debug: Log element dimensions
              console.log('Element dimensions:', {
                  width: element.offsetWidth,
                  height: element.offsetHeight,
                  scrollWidth: element.scrollWidth,
                  scrollHeight: element.scrollHeight,
                  rect: element.getBoundingClientRect()
              });
              
              // Try the main PDF generation
              html2pdf().set(opt).from(element).save().then(function() {
                  btn.innerHTML = originalText;
                  btn.disabled = false;
              }).catch(function(error) {
                  console.error('PDF generation failed:', error);
                  
                  // Fallback: Try with simpler options
                  const simpleOpt = {
                      margin: 0.5,
                      filename: 'AI_Trade_Report.pdf',
                      image: { type: 'jpeg', quality: 0.8 },
                      html2canvas: { 
                          scale: 1,
                          backgroundColor: '#ffffff',
                          width: element.scrollWidth,
                          height: element.scrollHeight,
                          useCORS: true,
                          scrollX: 0,
                          scrollY: 0
                      },
                      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
                  };
                  
                  html2pdf().set(simpleOpt).from(element).save().then(function() {
                      btn.innerHTML = originalText;
                      btn.disabled = false;
                  }).catch(function(fallbackError) {
                      console.error('Fallback PDF generation also failed:', fallbackError);
                      alert('PDF generation failed. Please use the Print button and save as PDF from your browser instead.');
                      btn.innerHTML = originalText;
                      btn.disabled = false;
                  });
              });
          }, 500);
      }, 1000);
  }
  
  // Also make it available on window object
  window.downloadPDF = downloadPDF;
  
  // Save report function
  // Track if report is saved
  let isReportSaved = false;
  
  function saveReport() {
      console.log('Save report function called');
      
      const btn = event.target.closest('.action-btn');
      if (!btn) {
          console.error('Save button not found');
          return;
      }
      
      // Check if already saved
      if (isReportSaved) {
          btn.innerHTML = '✅ Already Saved';
          btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
          btn.disabled = true;
          
          setTimeout(() => {
              btn.innerHTML = '💾 Save';
              btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
              btn.disabled = false;
          }, 2000);
          return;
      }
      
      const originalText = btn.innerHTML;
      
      // Show loading state
      btn.innerHTML = '⏳ Saving...';
      btn.disabled = true;
      
      try {
          // Get report data
          const reportTitle = document.querySelector('h1')?.textContent || 'AI Trade Report';
          const reportContent = document.getElementById('report-content')?.innerHTML || '';
          const currentUrl = window.location.pathname;
          const filename = currentUrl.split('/').pop() || 'unknown_report.html';
          
          console.log('Report data extracted:', {
              title: reportTitle,
              filename: filename,
              contentLength: reportContent.length
          });
          
          // Extract report metadata from URL or page
          const brand = document.querySelector('.summary-item:nth-child(1) .item-value')?.textContent || 'Unknown Brand';
          const product = document.querySelector('.summary-item:nth-child(2) .item-value')?.textContent || 'Unknown Product';
          const budget = document.querySelector('.summary-item:nth-child(3) .item-value')?.textContent || 'Unknown Budget';
          const enterpriseSize = document.querySelector('.summary-item:nth-child(4) .item-value')?.textContent || 'Unknown Size';
          
          // Prepare data for API
          const reportData = {
              title: reportTitle,
              brand: brand,
              product: product,
              budget: budget,
              enterprise_size: enterpriseSize,
              ai_model: 'gpt-5',
              language: 'en',
              content: reportContent,
              file_path: filename
          };
          
          console.log('Sending data to API:', reportData);
          
          // Send to database
          fetch('/save-report', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify(reportData)
          })
          .then(response => {
              console.log('API response status:', response.status);
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
          })
          .then(data => {
              console.log('API response data:', data);
              if (data.status === 'success') {
                  isReportSaved = true; // Mark as saved
                  btn.innerHTML = '✅ Saved!';
                  btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                  
                  setTimeout(() => {
                      btn.innerHTML = '💾 Save';
                      btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
                      btn.disabled = false;
                  }, 2000);
              } else {
                  throw new Error(data.message || 'Failed to save report');
              }
          })
          .catch(error => {
              console.error('Error saving report:', error);
              btn.innerHTML = '❌ Error';
              btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
              
              setTimeout(() => {
                  btn.innerHTML = originalText;
                  btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
                  btn.disabled = false;
              }, 3000);
          });
      } catch (error) {
          console.error('Error in saveReport function:', error);
          btn.innerHTML = '❌ Error';
          btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
          
          setTimeout(() => {
              btn.innerHTML = originalText;
              btn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
              btn.disabled = false;
          }, 3000);
      }
  }
  
  // Return to main page function
  function returnToMain() {
      if (isReportSaved) {
          // If report is saved, go directly without warning
          window.location.href = '/';
      } else {
          // If not saved, show warning
          if (confirm('Are you sure you want to return to the main page? Your current report will be lost.')) {
              window.location.href = '/';
          }
      }
  }
  
  // Make functions available globally
  window.saveReport = saveReport;
  window.returnToMain = returnToMain;
 
          // Hide header when printing
  window.addEventListener('beforeprint', function() {
      const header = document.querySelector('.report-header');
      if (header) header.style.display = 'none';
  });
  
  window.addEventListener('afterprint', function() {
      const header = document.querySelector('.report-header');
      if (header) header.style.display = 'block';
  });
  
  // Ensure function is available when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
      // Function should be available now
      if (typeof downloadPDF === 'function') {
          console.log('downloadPDF function is ready');
      } else {
          console.error('downloadPDF function not properly defined');
      }
  });
  
  // Also try to make it available immediately
  if (typeof downloadPDF === 'function') {
      console.log('downloadPDF function loaded successfully');
  }
    </script>
</body>
</html>